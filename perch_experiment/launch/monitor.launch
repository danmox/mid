<launch>

  <arg name="id"/>

  <arg name="rviz"       default="true"/>
  <arg name="show_flows" default="false"/>
  <arg name="monitor"    default="true"/>

  <arg name="scenario"   default="3task0mid.yaml"/>

  <!-- global parameters -->

  <rosparam command="load"
            file="$(find perch_experiment)/config/$(arg scenario)"/>

  <!-- nodes -->

  <node name="rviz" pkg="rviz" type="rviz" if="$(arg rviz)"
        args="-d $(find perch_experiment)/rviz/monitor.rviz"/>

  <group ns="node$(arg id)">

    <!-- network visualization -->
    <node pkg="or_protocol" name="routing_visualizer" type="routing_visualizer"
          output="screen">
      <remap from="state"       to="agg_status"/>
      <remap from="network_viz" to="/network_viz"/>
      <param name="offset"     value="0.5"/>
      <param name="stride"     value="0.15"/>
      <param name="show_flows" value="$(arg show_flows)"/>
    </node>

    <!-- ORNode in monitoring mode -->
    <node name="or_node" pkg="or_protocol" type="or_node" output="screen">
      <param name="IP"     value="192.168.0.$(arg id)"/>
      <param name="monitor" value="$(arg monitor)"/>
    </node>

    <!-- combine all overheard status messages -->
    <node name="status_aggregator" pkg="or_protocol" type="status_aggregator"
          output="screen">
      <remap from="status" to="monitor/network_status"/>
    </node>

    <!-- visualize exploration process -->
    <node pkg="perch_experiment" type="exploration_vis" name="exploration_vis"
          output="screen">
      <remap from="status"      to="monitor/network_status"/>
      <remap from="exploration" to="/exploration"/>
    </node>


  </group>

</launch>
